# czitools v0.13.0 — Release notes

Release date: 2025-12-12

Summary
-------
This release focuses on robustness for reading CZI files, better lazy/dask handling,
documentation and API hygiene improvements, and convenience utilities for visualization.

Highlights
----------
- read_stacks: added `planes` support (same semantics as `read_6darray`), a
  `chunk_policy` option and a safe `chunk_memory_limit` heuristic to avoid
  creating huge single chunks when rechunking for stacking. Fixed Dask reshape
  issues by building dask arrays via recursive stacking instead of reshape.
- read_6darray: no longer mutates caller-provided `planes` dicts; input is
  normalized on a local copy and the normalized planes are available on the
  returned xarray DataArray via `attrs['subset_planes']`.
- read_stacks/read_6darray: improved handling for files without explicit
  scenes — by default `read_stacks()` returns an empty list when no scenes are
  present, unless `stack_scenes=True` is used to treat the full image as a
  single implicit stack.
- Added `get_pyczi_readertype()` integration to support URL vs local file
  reading paths and ensure delayed readers get the correct ReaderFileInputType.
- New utility `czitools.utils.napari_tools.display_xarray_in_napari()` to
  centralize Napari display logic used by demos. Napari imports are lazy and
  optional (czitools does not require napari).
- Improved docstrings, typing, and comments in metadata tools and read utilities.
- Several tests added and updated to cover new behaviors and to ensure
  non-mutation of inputs and correct no-scenes handling.

Developer notes
---------------
- `read_stacks()` gains two new arguments: `chunk_policy` and
  `chunk_memory_limit`. See function docstring for details.
- `read_6darray()` will no longer mutate the `planes` argument — callers
  expecting mutation should instead read normalized planes from the returned
  array attrs or adapt their code accordingly.

Files changed (summary)
----------------------
- src/czitools/read_tools/read_tools.py — major updates to `read_stacks`,
  `read_6darray`, dask stacking and chunking heuristics.
- src/czitools/utils/napari_tools.py — new helper to display xarray in Napari
- demo/scripts/use_read_tools.py — updated to use the new napari helper
- src/czitools/_tests/test_read_6darray_no_mutation.py — new test

If you maintain changelog files or want a GitHub release entry, you can use
this file as the release body. If you want me to create the annotated git tag
and push it, I can attempt that next (note: pushing requires write access to
the remote repository).
